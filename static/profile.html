<!DOCTYPE HTML>
<html>
 <head>
   <meta charset="utf-8">
   <link rel="stylesheet" type="text/css" href="css/style.css">
   <link rel="stylesheet" type="text/css" href="css/profile.css">
 </head>
 <body>
    <div class="back-panel">
        <a href="chats" class="circle-back">
            <svg viewBox="0 0 24 24" fill="white" width="24px" height="24px" style="margin: 5px">
                <path d="M0 0h24v24H0z" fill="none"/>
                <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
            </svg>
        </a>
    </div>

    <div class="info-panel">
        <div class="avatar">
            <div class="circle">
                <svg fill="#bbc3c5a8" width="65px" height="65px" viewBox="0 0 16 16" style="z-index: -1;">
                    <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
                    <path d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z"/>
                </svg>
            </div>
            <a href="#openEditModal" class="circle-overlay" id="circle-overlay">
                Поменять<br>аватар
            </a>
        </div>

        <h2 id="user-name">Name<h2>

        <div id="info-items"></div>
        <div id="password-items"></div>

        <a class="btn-confirm" id="btn-save" onclick="onSave()"
            style="display: none; width: 50%; text-align: center; margin: auto;">Сохранить</a>

        <div class="row" id="data-change-link">
            <a onclick="onDataChange()">Изменить данные</a>
        </div>
        <div class="row" id="password-change-link">
            <a onclick="onPasswordChange()">Изменить пароль</a>
        </div>
        <div class="row" style="border: none;" id="exit-link">
            <a href="/" class="close">Выйти</a>
        </div>

        <!-- Модальное окно -->
        <div id="openEditModal" class="blackout">
            <div class="modalDialog" style="height: 200px">
                <h2>Загрузите файл</h2>
                <a href="500-error" style="font-size: 18px;">Выберите файл на компьютере</a>

                <a href="" class="btn-confirm ">Поменять</a>
            </div>
        </div>

    </div>

    <script type="text/template" id="info-item-template">
        <div class="row">
            <h4>_title</h4>
            <input class="info-input" value="_value" id="_id" disabled/>
        </div>
    </script>

    <script type="text/template" id="password-item-template">
        <div class="row">
            <h4>_title</h4>
            <input class="password-input" type="password" id="_id"/>
        </div>
    </script>

    <script>
        let infoItems = [
            {id: 'email', title: 'Почта', value: 'pochta@yandex.ru'},
            {id: 'login', title: 'Логин', value: 'dimonfrolov'},
            {id: 'first_name', title: 'Имя', value: 'Дмитрий'},
            {id: 'second_name', title: 'Фамилия', value: 'Фролов'},
            {id: 'display_name', title: 'Имя в чате', value: 'Димон'},
            {id: 'phone', title: 'Телефон', value: '+7 (913) 723-10-12'}
        ];

        let passwordItems = [
            {id: 'oldPassword', title: 'Старый пароль'},
            {id: 'newPassword', title: 'Новый пароль'},
            {id: 'newPasswordAgain', title: 'Повторите новый пароль'}
        ];

        // info items page render 
        render(infoItems, document.getElementById('info-item-template').innerHTML, 'info-items');

        function onSave() {
            // redrawing page to its original view
            setDisplayValueForElements('');
            document.getElementById('btn-save').style.display = 'none'; 

            infoItems.forEach(x => {
                let infoElement = document.getElementById(x.id);
                if (infoElement) {
                    infoElement.parentNode.style.display = '';
                    infoElement.parentNode.setAttribute('disabled', 'disabled');
                }
            })

            passwordItems.forEach(x => {
                let passwordElement = document.getElementById(x.id);
                if (passwordElement) {
                    passwordElement.parentNode.style.display = 'none';
                }
            })
        }

        function onDataChange() {
            setDisplayValueForElements('none');
            document.getElementById('btn-save').style.display = 'block'; 

            infoItems.forEach(x => {
                document.getElementById(x.id).removeAttribute('disabled');
                document.getElementById(x.id).onchange = onChange;
            });
        }

        function onPasswordChange() {
            setDisplayValueForElements('none');
            document.getElementById('btn-save').style.display = 'block'; 

            const dataElements = document.getElementById('info-items').children;
            for (let i = 0; i < dataElements.length; i++) {
                dataElements[i].style.display = 'none'; 
            }

            // password items page render 
            render(passwordItems, document.getElementById('password-item-template').innerHTML, 'password-items');

            passwordItems.forEach(x => {
                document.getElementById(x.id).onchange = onChange;
            });
        }

        function setDisplayValueForElements(value) {
            document.getElementById('user-name').style.display = value;
            document.getElementById('data-change-link').style.display = value;
            document.getElementById('password-change-link').style.display = value;
            document.getElementById('exit-link').style.display = value; 
            document.getElementById('circle-overlay').style.display = value; 
        }

        function onChange() {
            console.log(this, this.value);
        }

        function render(items, template, parentElementId) {
            let html = '';

            items.forEach(item => { 
                html += template.replace('_title', item.title)
                                .replace('_value', item.value)
                                .replace('_id', item.id);
            });

            document.getElementById(parentElementId).innerHTML = html;
            
            let name = items.find(x => x.id == 'display_name')?.value;
            if (name) {
                document.getElementById('user-name').textContent = name;
            }
        }
    </script>
 </body>
</html>